<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Library</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Libre Baskerville', serif;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 50%, #fab1a0 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        .pixelated-text {
            font-family: 'Press Start 2P', cursive;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.3;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #f8e5d8 0%, #f5d5c0 100%);
            border-right: 2px solid #d4a574;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .library-title {
            color: #8b6f47;
            font-size: 18px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .library-subtitle {
            font-size: 11px;
            color: #a0826d;
            font-style: italic;
        }
        
        /* Sections List */
        .sections-container {
            margin-bottom: 20px;
        }
        
        .section-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .section-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--section-color, #f0b27a);
            transition: width 0.3s ease;
        }
        
        .section-item:hover::before {
            width: 8px;
        }
        
        .section-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .section-item.active {
            background: linear-gradient(135deg, #fff5e6 0%, #ffe0b2 100%);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-name {
            font-size: 12px;
            font-weight: bold;
            color: #5d4e37;
        }
        
        .section-count {
            font-size: 10px;
            color: #a0826d;
            background: rgba(255,255,255,0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .section-icon {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .add-section-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdbb 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .add-section-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
        }
        
        .content-header {
            background: linear-gradient(135deg, #f8e5d8 0%, #f5d5c0 100%);
            padding: 20px 30px;
            border-bottom: 2px solid #d4a574;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title {
            color: #5d4e37;
            font-size: 20px;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .icon-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        /* Books Grid */
        .books-container {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 25px;
        }
        
        .book-card {
            background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 250px;
            display: flex;
            flex-direction: column;
        }
        
        .book-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #f0b27a, #f7dc6f, #a8e6cf);
            border-radius: 15px 15px 0 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .book-card:hover::before {
            opacity: 1;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .book-spine {
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #d4a574 0%, #c19a6b 50%, #d4a574 100%);
            border-radius: 2px;
            margin-bottom: 15px;
        }
        
        .book-title {
            font-size: 14px;
            font-weight: bold;
            color: #5d4e37;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .book-author {
            font-size: 11px;
            color: #a0826d;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .book-preview {
            font-size: 11px;
            color: #7d6d5d;
            line-height: 1.6;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 6;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .book-actions {
            display: flex;
            justify-content: flex-end;
            gap: 5px;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .book-card:hover .book-actions {
            opacity: 1;
        }
        
        .small-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .delete-btn {
            background: #ffb3ba;
            color: #8b0000;
        }
        
        .delete-btn:hover {
            background: #ff9999;
        }
        
        .edit-btn {
            background: #bae1ff;
            color: #004080;
        }
        
        .edit-btn:hover {
            background: #a3d5ff;
        }
        
        /* Writing Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #fff8f0 0%, #fff5e6 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #f8e5d8 0%, #f5d5c0 100%);
            padding: 20px 30px;
            border-bottom: 2px solid #d4a574;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            color: #5d4e37;
            font-size: 18px;
        }
        
        .close-modal {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background: #ffb3ba;
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            color: #5d4e37;
            font-size: 12px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e8d4c1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #d4a574;
        }
        
        /* Text Editor */
        .editor-toolbar {
            display: flex;
            gap: 5px;
            padding: 10px;
            background: white;
            border: 2px solid #e8d4c1;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            flex-wrap: wrap;
        }
        
        .editor-btn {
            padding: 8px 12px;
            border: 1px solid #e8d4c1;
            background: white;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s ease;
        }
        
        .editor-btn:hover {
            background: #f8e5d8;
        }
        
        .editor-btn.active {
            background: #d4a574;
            color: white;
        }
        
        .editor-content {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 2px solid #e8d4c1;
            border-radius: 0 0 8px 8px;
            font-size: 14px;
            line-height: 1.8;
            background: white;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 31px,
                    #e8d4c1 31px,
                    #e8d4c1 32px
                );
            resize: vertical;
        }
        
        .editor-content:focus {
            outline: none;
            border-color: #d4a574;
        }
        
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdbb 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Section Customization Modal */
        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border-color: #5d4e37;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #5d4e37;
        }
        
        .icon-picker {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .icon-option {
            width: 50px;
            height: 50px;
            border: 2px solid #e8d4c1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .icon-option:hover {
            background: #f8e5d8;
        }
        
        .icon-option.selected {
            background: #d4a574;
            border-color: #5d4e37;
        }
        
        /* Background Upload */
        .upload-section {
            padding: 20px;
            border: 2px dashed #d4a574;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }
        
        .upload-label {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #ffd89b 0%, #f7dc6f 100%);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #5d4e37;
            font-weight: bold;
        }
        
        .upload-label:hover {
            transform: scale(1.05);
        }
        
        input[type="file"] {
            display: none;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0826d;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .empty-subtitle {
            font-size: 14px;
            font-style: italic;
        }
        
        /* View Book Modal */
        .view-modal {
            background: linear-gradient(135deg, #fff8f0 0%, #fff5e6 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .paper-content {
            background: white;
            margin: 30px;
            padding: 40px;
            border-radius: 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
            min-height: 400px;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 31px,
                    rgba(232, 212, 193, 0.3) 31px,
                    rgba(232, 212, 193, 0.3) 32px
                );
        }
        
        .view-title {
            font-size: 24px;
            color: #5d4e37;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .view-author {
            font-size: 14px;
            color: #a0826d;
            text-align: center;
            font-style: italic;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e8d4c1;
        }
        
        .view-content {
            font-size: 16px;
            line-height: 2;
            color: #3d3d3d;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Font size selector */
        .font-size-selector {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border: 1px solid #e8d4c1;
            border-radius: 5px;
        }

        .font-size-selector select {
            border: none;
            background: none;
            cursor: pointer;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 2px solid #d4a574;
            }
            
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
.change-bg-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  cursor: pointer;
  display: inline-block;
}

.ditto-icon {
  width: 50px;
  height: 50px;
  image-rendering: pixelated;
  transition: transform 0.2s ease;
  display: block;
  margin: 0 auto;
}

.ditto-icon:hover {
  transform: scale(1.1);
}

.change-bg-btn input {
  display: none;
}

/* Tooltip below the icon, horizontal but responsive */
.tooltip-text {
  visibility: hidden;
  opacity: 0;
  position: absolute;
  top: 60px; /* below Ditto GIF */
  left: 50%;
  transform: translateX(-50%);
  background: #5d4e37;
  color: white;
  font-size: 10px;
  padding: 6px 10px;
  border-radius: 5px;
  transition: opacity 0.2s ease;
  white-space: normal;       /* allow wrapping if needed */
  max-width: 200px;          /* keep it from being too wide */
  word-break: break-word;    /* break words if necessary */
  text-align: center;
  z-index: 10;
  font-family: 'Press Start 2P', cursive; /* pixelated font */
  box-shadow: 2px 2px 0 #2e1c0f; /* retro shadow */
}

/* Always show properly on hover */
.change-bg-btn:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}
.context-menu {
  position: absolute;
  display: none;
  background: #fff5e6;
  border: 2px solid #d4a574;
  border-radius: 8px;
  box-shadow: 4px 4px 0 #8b6f47;
  list-style: none;
  padding: 5px 0;
  z-index: 2000;
  font-family: 'Press Start 2P', cursive;
}

.context-menu li {
  padding: 8px 15px;
  cursor: pointer;
  font-size: 12px;
  color: #5d4e37;
}

.context-menu li:hover {
  background: #ffd180;
}



    </style>
</head>
<body>
    <div class="background-overlay" id="bgOverlay"></div>
    
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
<div class="sidebar-header" style="display:flex; align-items:center; justify-content:center; gap:10px;">
    <div style="text-align:center;">
        <h1 class="library-title pixelated-text">DIGITAL LIBRARY</h1>
        <p class="library-subtitle">Your Personal Collection</p>
    </div>

    <!-- Cleffa GIF on the right -->
    <img src="CLEFFA.gif" 
         alt="Pixel Cleffa" 
         width="60" 
         style="image-rendering: pixelated;">
</div>
            
            <div class="sections-container" id="sectionsContainer">
                <!-- Sections will be added here -->
            </div>
            
            <button class="add-section-btn pixelated-text" onclick="openSectionModal()">
                + NEW SECTION
            </button>
            

        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h2 class="section-title pixelated-text" id="currentSectionTitle">Select a Section</h2>
                <div class="header-actions">
                    <button class="icon-btn" onclick="openBookModal()" id="addBookBtn" style="display:none;">
                        <img src="pencil.png" alt="Write" style="width:24px; height:24px; image-rendering: pixelated;">
                    </button>
                    <button class="icon-btn" onclick="editCurrentSection()" id="editSectionBtn" style="display:none;">
                        üé®
                    </button>
                    <button class="icon-btn" onclick="deleteCurrentSection()" id="deleteSectionBtn" style="display:none;">
                        üóëÔ∏è
                    </button>
                    
                </div>
                <!-- Change Background Icon (Ditto GIF) -->
<div class="change-bg-btn">
  <label for="bgUploadTop">
    <img src="ICONFILE.gif" alt="Change Background" class="ditto-icon">
    <span class="tooltip-text pixelated-text">Background Change</span>
  </label>
  <input type="file" id="bgUploadTop" accept="image/*" onchange="changeBackground(event)">
</div>

            </header>
            
            <div class="books-container">
                <div class="books-grid" id="booksGrid">

                </div>
            </div>
        </main>
    </div>
    
    <!-- Book Writing/Editing Modal -->
    <div class="modal" id="bookModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title pixelated-text" id="bookModalTitle">Write New Book</h3>
                <button class="close-modal" onclick="closeBookModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="bookForm">
                    <input type="hidden" id="bookId">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="bookTitle" required placeholder="Enter book title...">
                    </div>
                    <div class="form-group">
                        <label>Author</label>
                        <input type="text" id="bookAuthor" required placeholder="Your name...">
                    </div>
                    <div class="form-group">
                        <label>Content</label>
                        <div class="editor-toolbar">
                            <button type="button" class="editor-btn" onclick="formatText('bold')"><b>B</b></button>
                            <button type="button" class="editor-btn" onclick="formatText('italic')"><i>I</i></button>
                            <button type="button" class="editor-btn" onclick="formatText('underline')"><u>U</u></button>
                            <div class="font-size-selector">
                                <span>Size:</span>
                                <select onchange="changeFontSize(this.value)">
                                    <option value="3">Normal</option>
                                    <option value="1">Small</option>
                                    <option value="2">Medium</option>
                                    <option value="4">Large</option>
                                    <option value="5">X-Large</option>
                                </select>
                            </div>
                        </div>
                        <div class="editor-content" contenteditable="true" id="bookContent"></div>
                    </div>
                    <button type="submit" class="submit-btn pixelated-text">SAVE BOOK</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Section Creation/Edit Modal -->
    <div class="modal" id="sectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title pixelated-text" id="sectionModalTitle">Create New Section</h3>
                <button class="close-modal" onclick="closeSectionModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="sectionForm">
                    <input type="hidden" id="sectionId">
                    <div class="form-group">
                        <label>Section Name</label>
                        <input type="text" id="sectionName" required placeholder="e.g., Fantasy, Poetry, Journals...">
                    </div>
                    <div class="form-group">
                        <label>Choose Color Theme</label>
                        <div class="color-picker" id="colorPicker">
                            <div class="color-option" style="background: #ffb3ba" data-color="#ffb3ba"></div>
                            <div class="color-option" style="background: #ffdfba" data-color="#ffdfba"></div>
                            <div class="color-option" style="background: #ffffba" data-color="#ffffba"></div>
                            <div class="color-option" style="background: #baffc9" data-color="#baffc9"></div>
                            <div class="color-option" style="background: #bae1ff" data-color="#bae1ff"></div>
                            <div class="color-option" style="background: #e0bbe4" data-color="#e0bbe4"></div>
                            <div class="color-option" style="background: #f0b27a" data-color="#f0b27a"></div>
                            <div class="color-option" style="background: #a8e6cf" data-color="#a8e6cf"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Choose Icon</label>
                        <div class="icon-picker" id="iconPicker">
                            <div class="icon-option" data-icon="üìö">üìö</div>
                            <div class="icon-option" data-icon="üìñ">üìñ</div>
                            <div class="icon-option" data-icon="‚ú®">‚ú®</div>
                            <div class="icon-option" data-icon="üåü">üåü</div>
                            <div class="icon-option" data-icon="üé®">üé®</div>
                            <div class="icon-option" data-icon="üå∏">üå∏</div>
                            <div class="icon-option" data-icon="üåô">üåô</div>
                            <div class="icon-option" data-icon="‚òÄÔ∏è">‚òÄÔ∏è</div>
                            <div class="icon-option" data-icon="üçÉ">üçÉ</div>
                            <div class="icon-option" data-icon="ü¶ã">ü¶ã</div>
                            <div class="icon-option" data-icon="üé≠">üé≠</div>
                            <div class="icon-option" data-icon="üîÆ">üîÆ</div>
                        </div>
                    </div>
                    <button type="submit" class="submit-btn pixelated-text">SAVE SECTION</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- View Book Modal -->
    <div class="modal" id="viewBookModal">
        <div class="view-modal modal-content">
            <div class="modal-header">
                <h3 class="modal-title pixelated-text">Reading Mode</h3>
                <button class="close-modal" onclick="closeViewModal()">√ó</button>
            </div>
            <div class="paper-content">
                <h1 class="view-title" id="viewTitle"></h1>
                <p class="view-author" id="viewAuthor"></p>
                <div class="view-content" id="viewContent"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Data Structure
        let library = {
            sections: [],
            books: [],
            currentSection: null,
            backgroundImage: null
        };
        
        // Load data on startup
        window.addEventListener('DOMContentLoaded', () => {
            loadLibrary();
            setupColorPicker();
            setupIconPicker();
            setupBookForm();
            setupSectionForm();
        });
        
function loadLibrary() {
    const saved = localStorage.getItem('digitalLibrary');
    if (saved) {
        library = JSON.parse(saved);
        if (library.backgroundImage) {
            document.getElementById('bgOverlay').style.backgroundImage = `url(${library.backgroundImage})`;
        }
    } else {
        library = { sections: [], books: [], backgroundImage: null };
    }

    // Ensure demo section exists
    let section = library.sections.find(s => s.name === 'My First Collection');
    if (!section) {
        section = {
            id: Date.now(),
            name: 'THE EIGHTEEEEEN',
            color: '#f0b27a',
            icon: 'üìö'
        };
        library.sections.push(section);
    }

    // Define the 18 demo books you want to appear
    const demoBooks = [
        { title: 'NUMERO ONE', author: 'Mabby', content: '<p>Hey babe! so this is the little project ive bene working on for the past few days as a sort of failsafe since i cant exactly write 18 notes without arousing the suspicion of my mom HAHAHAHA. So here is me programming a website that will allow you to read this on the 2nd oc October. I love you babyyyy. This is the first note of the 18 I will be making. Mwah mwah UWAU.</p>' },
        { title: 'Number DOS', author: 'MABBEH', content: '<p>Heres the second note of the series UWWAU. I know this is kinda underwhelming but i mena its pretty cool but im sorry i couldnt write you 18 notes physically. Anyways, number 2 is me ranting about how beatiful you are UWAU. You keeo denying your beauty and I hate it very much hmphhh. Be mrore confident love you are an absolutely amazing person in many regards UWAU to the max.</p>' },
        { title: 'NUMBAH 3333', author: 'MUBBY', content: '<p>Number 3 is one of those unlucky number yknow? HAHAHHA. Anyways, I want to have many more wondeful memories with you baby as 2 years worth of memories just isnt enought :(((. It just sucks :<<<<. We should definitely do more awesome stuff this college since yeah its college and all that stuff since yeah :<<<. I am not exactly a creative type as you can see since i have almost nothing interesting to say :<<<. I LOVE YOUUUUUUUU.</p>' },
        { title: 'FOURRRRRRRRRR', author: 'MABS', content: '<p>I had the thought of making a website since i think its pretty neat and you can visit these anytime that you feel like it. Plus I wanted to make things looks aesthetic but im not exactly a very aesthetic person so please forgive me if this looks abd :(((. What a wonderful thing it is that weve met each other, otherwise i wouldve been a sad sad human being HAHAHAHAHAH. I love you frfr babe. Invent teleportation already because i miss you legit.</p>' },
        { title: 'SINKOOOO', author: 'Bebiii', content: '<p>I can change the author name and i have realized just how many nicknames i have acquired from you throughout the years and its quite nice. Keep calling me nicknames lobeyyyy and i wish to call you some more wonderful oens in thhe future yessssss. Its unbelievable that I am no longer a lone human but am now with a pair and that is you my wonderful little baby UWAU.</p>' },
        { title: 'SIX :(((', author: ':<<<<', content: '<p>Six is the date i keep confusing my birthday by. I do wonder why but i think its because of the 2006 thing and its pretty dumbbbbb. Anwywasy. I hope youres till reading because typing these out is pretty hard HAHHAHHAHAAH. Ive set these as the default :(((. You can also use these as a notes app sometimes if you want but i cant see your messages on this one. I plan on upgrading ths more if you truly want it.</p>' },
        { title: 'SEVEN IS MY NUMBER', author: 'MAHENNN', content: '<p>7 is the date of my birthday frfr. I seriously wanna see you babe and i miss you frfrfr like wthhhhh. I love you babe and forever more and most UWAU. I will always win the I love you battle against you blehhhh. Because i am superior in lovee UWAU. You can feel the overpowered nature of my superlove and I am the super love. Idk what im talking about anymore UWAU.</p>' },
        { title: 'Eightttthajfhijfh', author: 'UWAUS in the chat', content: '<p>Why was 6 afraid of 7? Because 7 8 9 HAHAHAHAHAHAHAHAH. I hope you get it because if you dont then i am sad and my jokes are supeer unfunny now :((((. Do you even love me? Would you still love me if i was a worm? :(((((. I AM SADDEST X INFINITY HMPHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH. HAHAHAHAHAAHAHAHHAAHHAAHH I AM CRAZYYYYYYYYYYYYYYYYYYYYYYYYYY IN LOVEEEEEEEEEEEEEEEEEEE WITHHHHHHHHHHHHHHHH YOUUUUUUUUUUUUUUUUUUUU.</p>' },
        { title: 'NINE IS YOUR FAVE NUMBERRR', author: 'A cool mabbyyyy', content: '<p>Your favorite number is 9 and i think thats pretty neat babe. You should keep loving nine since 9 is a cool number frfr and i will love you x infinity for lobving 9 legit frfr cuh HAHAHAHAHAHAHAHH. I hope we get to do more fun stuff babe like frrrrrrrrr its fun hanging out with the love of your life ehhhh.</p>' },
        { title: '1000000', author: '10 is a mid number', content: '<p>yknow 10 is kinda a mid number. Like its a combination of a 1 and 0 and i think thats kinda lame like a 1 and a 0 frfr??? I love you ;DDDDD. Di mo yun inexpect nooo? NO OF COURSE! because im cool like that and I am superior when it comes to love UWAUs in the chat frfr HAHAHAHAHAHAH. this is pretty fun hmph hmph hmph. YEAHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH.</p>' },
        { title: '11 kinda sucks its just 2 ones', author: '11 is a number that sucks', content: '<p>11 kinda sucks since its just 2 1s and thats a pretty sucky thing for a number yknow? not like you, youre the coolest girl on this universe and thats a matter of fact HAHAHAHAHAHHAH YOU ARE THE BEST BABY IN THIS UNIVERSE AND NOONE CAN EVER DENY THAT FACT LIKE FRFR BECAUSE I SAID SO AND IT IS A FACT UWAUUUUUUUUUUUUUUUU.</p>' },
        { title: 'ITS A 12', author: 'MOBBAAAA', content: '<p>When we were in g12 I love spending every second of my free time with you. Lunch, free time in the afternoon, and a lot of other things. Now, in college, we cant exactly do that as much and that kinda is a super sucky thing for this college to do ;<<<<. So i hope in the coming months and years we can spend more time together like going on trips and such so we can further have fun and make the most of our youth years UWAU.</p>' },
        { title: '13 is an unlucky number', author: 'JOHNNYYYY', content: '<p>friday he 13th and all that jazz, you get the point. 13 is an unlucky number and yade yade yada but who started that i wonder? but were never unlucky because we have you my love. You are super duper lucky and very beautiful and pretty and great and amazing UWAUUUU. Please look at yourself in a brighter light more often babe as  it makes me very sad that youre being sad and negative and such.</p>' },
        { title: '14 is valentines on february UWU', author: 'VALENTINES', content: '<p>I should definitely do something super cool for you on valentines because yknow, day of love and such. I wanna do something more for you that is loveky and super duper caring because yujhhhhh. One upping the previous years is my goal since it just kinda shows an improvement and a change in the situation and being more creative in showing mu love for you yuhhhhh.</p>' },
        { title: 'fifteen in words', author: ':3', content: '<p>Babe, I love you. No matter how negative things get, I will alwasy love you alwways and forever and ever. That is a never changing factor of this relationship and you can be rest assured for the rest of our time togeyher. Keep it in mind for the rest of your life since ill be here for eternity UWAU.</p>' },
        { title: 'We met each other when we were 16', MEMES: 'Thinker', content: '<p>I remember the first time i talked to you was sharing a necromancer meme and you not getting it and it evolved into me calling you cute plenty of times and one thing led to another and now we are a year and a half together and What a wonderful thing it is that this has happened and what a blessing it is and I am so grateful for you.</p>' },
        { title: 'then it became 17', author: 'BEBU', content: '<p>We then became 17 and we started engaging more and more like deidcating lunch time together and having fun walking aroun and sharing and talking about random topics on random places around the campus and it was so muc fun and I wish we can do that more but college is a bitch and now we only meet like twice a week if were lucky HAHAHAHAH. I wish to see you more often babe. I miss you.</p>' },
        { title: 'Now were 18', author: 'Baby', content: '<p>This is the 18th Notes. Now youre 18 and I am 18. Weve come a long way my love. 18 months together as well coincidentally. A very cool coincidence if you were to ask me HAHAHAHAHA. This note shall be deidcated to ultimatums for the future. We shall see and experience more fun things from here on and we shall be together more and more and more from here on. You and I will be forever because that is a fact and that is a very awesome fact that will remain true for all of eternity. You are the prettiest lady in the universe and that remains to be an unbreakable fact. It shall never be disproven and will never be a false thing. Love is not false. Happy Birthday, Baby. I love you x infinity. MWAH MWAH. KISS KISS, BITE BITE, HUG HUG, CUDDLE CUDDLE, SMOOCH SMOOCH, TICKLE TICKLE, SNUGGLE SNUGGLE. UWAUUUUU I LOVE YOUU X INFITYYYYYY.</p>' }
    ];

    // Sync demo books (update or add)
    demoBooks.forEach((demo, i) => {
        let book = library.books.find(b => b.sectionId === section.id && b.title === demo.title);
        if (!book) {
            // If missing, add it
            library.books.push({
                id: section.id + i + 1,
                sectionId: section.id,
                title: demo.title,
                author: demo.author,
                content: demo.content,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            });
        } else {
            // If exists, update with the latest text from GitHub code
            book.author = demo.author;
            book.content = demo.content;
            book.updatedAt = new Date().toISOString();
        }
    });

    renderSections();
    renderHome();
    saveLibrary();
}

        
        function saveLibrary() {
            localStorage.setItem('digitalLibrary', JSON.stringify(library));
        }
        
        // Section Management
        function renderSections() {
            const container = document.getElementById('sectionsContainer');
            container.innerHTML = library.sections.map(section => {
                const bookCount = library.books.filter(b => b.sectionId === section.id).length;
                return `
                    <div class="section-item ${library.currentSection === section.id ? 'active' : ''}" 
                         onclick="selectSection(${section.id})"
                         style="--section-color: ${section.color}">
                        <div class="section-header">
                            <div>
                                <div class="section-icon">${section.icon}</div>
                                <div class="section-name">${section.name}</div>
                            </div>
                            <span class="section-count">${bookCount} books</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
function selectSection(sectionId) {
    library.currentSection = sectionId;
    const section = library.sections.find(s => s.id === sectionId);
    if (!section) return;

    document.getElementById('currentSectionTitle').textContent = section.name;
    ['addBookBtn', 'editSectionBtn', 'deleteSectionBtn'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'block';
    });

    // Hide Ditto inside
    const changeBtn = document.querySelector('.change-bg-btn');
    if (changeBtn) changeBtn.style.display = 'none';

    // Show back arrow
    const backArrow = document.getElementById('backArrow');
    if (backArrow) backArrow.style.display = 'inline';

    renderBooks();
    saveLibrary();
}
function renderHome() {
    const container = document.getElementById('booksGrid');
    if (!container) return;

    // Reset title + hide section-only buttons
    document.getElementById('currentSectionTitle').textContent = "üìö My Library";
    ['addBookBtn', 'editSectionBtn', 'deleteSectionBtn'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
    });

    // Show Ditto only at home
    const changeBtn = document.querySelector('.change-bg-btn');
    if (changeBtn) changeBtn.style.display = 'block';

    // Sections ‚Üí cards
    if (!library.sections || library.sections.length === 0) {
        container.innerHTML = `
            <div class="book-card">
                <div class="book-spine"></div>
                <h3 class="book-title pixelated-text">No Sections Yet</h3>
                <p class="book-author">Right-click to create your first section</p>
            </div>
        `;
    } else {
        container.innerHTML = library.sections.map(section => `
            <div class="book-card" onclick="selectSection(${section.id})">
                <div class="book-spine"></div>
                <h3 class="book-title pixelated-text">${escapeHtml(section.name)}</h3>
                <p class="book-author">${library.books.filter(b => b.sectionId === section.id).length} books</p>
            </div>
        `).join('');
    }

    // Refresh sidebar
    if (typeof renderSections === 'function') renderSections();

    // Hide back arrow
    const backArrow = document.getElementById('backArrow');
    if (backArrow) backArrow.style.display = 'none';

    library.currentSection = null;
}

        
        function renderBooks() {
            const container = document.getElementById('booksGrid');
            const sectionBooks = library.books.filter(b => b.sectionId === library.currentSection);
            
            if (sectionBooks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <h3 class="empty-title pixelated-text">No books yet</h3>
                        <p class="empty-subtitle">Click the ‚úçÔ∏è button to write your first book</p>
                    </div>
                `;
                return;


    // Hide the back arrow when on home
    document.getElementById('backArrow').style.display = 'none';
}



// Hide the back arrow when on home (if it exists)
const backArrow = document.getElementById('backArrow');
if (backArrow) backArrow.style.display = 'none';



            
            container.innerHTML = sectionBooks.map(book => `
                <div class="book-card" onclick="viewBook(${book.id})">
                    <div class="book-spine"></div>
                    <h3 class="book-title">${escapeHtml(book.title)}</h3>
                    <p class="book-author">by ${escapeHtml(book.author)}</p>
                    <p class="book-preview">${stripHtml(book.content).substring(0, 200)}...</p>
                    <div class="book-actions">
                        <button class="small-btn edit-btn" onclick="editBook(${book.id}, event)">Edit</button>
                        <button class="small-btn delete-btn" onclick="deleteBook(${book.id}, event)">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Book Modal Functions
        function openBookModal(bookId = null) {
            const modal = document.getElementById('bookModal');
            const form = document.getElementById('bookForm');
            
            if (bookId) {
                const book = library.books.find(b => b.id === bookId);
                if (book) {
                    document.getElementById('bookModalTitle').textContent = 'Edit Book';
                    document.getElementById('bookId').value = book.id;
                    document.getElementById('bookTitle').value = book.title;
                    document.getElementById('bookAuthor').value = book.author;
                    document.getElementById('bookContent').innerHTML = book.content;
                }
            } else {
                document.getElementById('bookModalTitle').textContent = 'Write New Book';
                form.reset();
                document.getElementById('bookContent').innerHTML = '';
                document.getElementById('bookId').value = '';
            }
            
            modal.classList.add('active');
        }
        
        function closeBookModal() {
            document.getElementById('bookModal').classList.remove('active');
        }
        
        function editBook(bookId, event) {
            event.stopPropagation();
            openBookModal(bookId);
        }
        
        function deleteBook(bookId, event) {
            event.stopPropagation();
            if (confirm('Are you sure you want to delete this book?')) {
                library.books = library.books.filter(b => b.id !== bookId);
                saveLibrary();
                renderBooks();
            }
        }
        
        function viewBook(bookId) {
            const book = library.books.find(b => b.id === bookId);
            if (book) {
                document.getElementById('viewTitle').textContent = book.title;
                document.getElementById('viewAuthor').textContent = `by ${book.author}`;
                document.getElementById('viewContent').innerHTML = book.content;
                document.getElementById('viewBookModal').classList.add('active');
            }
        }
        
        function closeViewModal() {
            document.getElementById('viewBookModal').classList.remove('active');
        }
        
// Section Modal Functions
function openSectionModal(sectionId = null) {
    const modal = document.getElementById('sectionModal');
    const form = document.getElementById('sectionForm');
    
    if (sectionId) {
        const section = library.sections.find(s => s.id === sectionId);
        if (section) {
            document.getElementById('sectionModalTitle').textContent = 'Edit Section';
            document.getElementById('sectionId').value = section.id;
            document.getElementById('sectionName').value = section.name;
            
            // Select color and icon
            document.querySelectorAll('.color-option').forEach(el => {
                el.classList.toggle('selected', el.dataset.color === section.color);
            });
            document.querySelectorAll('.icon-option').forEach(el => {
                el.classList.toggle('selected', el.dataset.icon === section.icon);
            });
        }
    } else {
        document.getElementById('sectionModalTitle').textContent = 'Create New Section';
        form.reset();
        document.getElementById('sectionId').value = '';
        document.querySelectorAll('.color-option, .icon-option').forEach(el => {
            el.classList.remove('selected');
        });
    }
    
    modal.classList.add('active');
}
window.openSectionModal = openSectionModal; // üëà Add this

        
        function closeSectionModal() {
            document.getElementById('sectionModal').classList.remove('active');
        }
        
        function editCurrentSection() {
            if (library.currentSection) {
                openSectionModal(library.currentSection);
            }
        }
        
        function deleteCurrentSection() {
            if (!library.currentSection) return;
            
            if (confirm('Are you sure you want to delete this section and all its books?')) {
                // Delete all books in this section
                library.books = library.books.filter(b => b.sectionId !== library.currentSection);
                
                // Delete the section
                library.sections = library.sections.filter(s => s.id !== library.currentSection);
                
                // Reset current section
                library.currentSection = null;
                document.getElementById('currentSectionTitle').textContent = 'Select a Section';
                document.getElementById('addBookBtn').style.display = 'none';
                document.getElementById('editSectionBtn').style.display = 'none';
                document.getElementById('deleteSectionBtn').style.display = 'none';
                
                saveLibrary();
                renderSections();
                
                // Show empty state
                document.getElementById('booksGrid').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìö</div>
                        <h3 class="empty-title pixelated-text">Welcome to Your Library</h3>
                        <p class="empty-subtitle">Create a section to start organizing your books</p>
                    </div>
                `;
            }
        }
        
        // Form Handlers
        function setupBookForm() {
            document.getElementById('bookForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const bookId = document.getElementById('bookId').value;
                const title = document.getElementById('bookTitle').value;
                const author = document.getElementById('bookAuthor').value;
                const content = document.getElementById('bookContent').innerHTML;
                
                if (!library.currentSection) {
                    alert('Please select a section first');
                    return;
                }
                
                if (bookId) {
                    // Edit existing book
                    const book = library.books.find(b => b.id === parseInt(bookId));
                    if (book) {
                        book.title = title;
                        book.author = author;
                        book.content = content;
                        book.updatedAt = new Date().toISOString();
                    }
                } else {
                    // Create new book
                    const newBook = {
                        id: Date.now(),
                        sectionId: library.currentSection,
                        title: title,
                        author: author,
                        content: content,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    library.books.push(newBook);
                }
                
                saveLibrary();
                renderBooks();
                renderSections();
                closeBookModal();
            });
        }
        
        function setupSectionForm() {
            document.getElementById('sectionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const sectionId = document.getElementById('sectionId').value;
                const name = document.getElementById('sectionName').value;
                const selectedColor = document.querySelector('.color-option.selected');
                const selectedIcon = document.querySelector('.icon-option.selected');
                
                const color = selectedColor ? selectedColor.dataset.color : '#f0b27a';
                const icon = selectedIcon ? selectedIcon.dataset.icon : 'üìö';
                
                if (sectionId) {
                    // Edit existing section
                    const section = library.sections.find(s => s.id === parseInt(sectionId));
                    if (section) {
                        section.name = name;
                        section.color = color;
                        section.icon = icon;
                    }
                } else {
                    // Create new section
                    const newSection = {
                        id: Date.now(),
                        name: name,
                        color: color,
                        icon: icon
                    };
                    library.sections.push(newSection);
                }
                
                saveLibrary();
                renderSections();
                closeSectionModal();
            });
        }
        
        // Color and Icon Pickers
        function setupColorPicker() {
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }
        
        function setupIconPicker() {
            document.querySelectorAll('.icon-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.icon-option').forEach(el => el.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }
        
        // Text Editor Functions
        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('bookContent').focus();
        }
        
        function changeFontSize(size) {
            document.execCommand('fontSize', false, size);
            document.getElementById('bookContent').focus();
        }
        
function changeBackground(event) {
    const file = event.target.files[0];
    if (file && file.type.startsWith('image/')) { // Changed this line
        const reader = new FileReader();
        reader.onload = function(e) {
            const imageUrl = e.target.result;
            document.getElementById('bgOverlay').style.backgroundImage = `url(${imageUrl})`;
            library.backgroundImage = imageUrl;
            saveLibrary();
        };
        reader.readAsDataURL(file);
    } else {
        alert('Please select an image file'); // Updated message
    }
}
        // Utility Functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function stripHtml(html) {
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }
        
        // Close modals on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
        
        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
            const contextMenu = document.getElementById('contextMenu');

document.querySelector('.books-container').addEventListener('contextmenu', (e) => {
    e.preventDefault();
    if (!library.currentSection) return; // only inside section
    contextMenu.style.top = e.pageY + 'px';
    contextMenu.style.left = e.pageX + 'px';
    contextMenu.style.display = 'block';
});

document.addEventListener('click', () => {
    contextMenu.style.display = 'none';
});
        });
        window.closeSectionModal = closeSectionModal;
window.openBookModal = openBookModal;
window.closeBookModal = closeBookModal;
window.editBook = editBook;
window.deleteBook = deleteBook;
window.viewBook = viewBook;
window.closeViewModal = closeViewModal;
window.editCurrentSection = editCurrentSection;
window.deleteCurrentSection = deleteCurrentSection;
window.formatText = formatText; 
window.changeFontSize = changeFontSize;
window.changeBackground = changeBackground;
window.selectSection = selectSection;
// === Custom Context Menu ===
window.addEventListener('DOMContentLoaded', () => {
    const contextMenu = document.getElementById('contextMenu');
    const mainContent = document.querySelector('.main-content');

    mainContent.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        contextMenu.innerHTML = "";

        if (!library.currentSection) {
            contextMenu.innerHTML = `
                <li onclick="openSectionModal()">‚ûï Create Section</li>
            `;
        } else {
            contextMenu.innerHTML = `
                <li onclick="openBookModal()">üìñ Create Book</li>
                <li onclick="document.getElementById('bgUploadTop').click()">üé® Change Section Background</li>
                <li onclick="editCurrentSection()">‚úèÔ∏è Edit Section</li>
                <li onclick="deleteCurrentSection()">üóëÔ∏è Delete Section</li>
            `;
        }

        contextMenu.style.top = e.pageY + "px";
        contextMenu.style.left = e.pageX + "px";
        contextMenu.style.display = "block";
    });

    document.addEventListener('click', () => {
        contextMenu.style.display = 'none';
    });
});


    </script>
<!-- Custom Context Menu -->
<ul id="contextMenu" class="context-menu">
  <li onclick="openBookModal()">üìñ Create Book</li>
  <li onclick="document.getElementById('bgUploadTop').click()">üé® Change Section Background</li>
  <li onclick="editCurrentSection()">‚úèÔ∏è Edit Section</li>
  <li onclick="deleteCurrentSection()">üóëÔ∏è Delete Section</li>
</ul>
</body>
</html> 


